# 03-æˆæƒå˜æ›´é€šçŸ¥æ¨é€

## æ¦‚è¿°

æˆæƒå˜æ›´é€šçŸ¥æ¨é€æ˜¯å¾®ä¿¡å¼€æ”¾å¹³å°åœ¨æˆæƒçŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå‘ç¬¬ä¸‰æ–¹å¹³å°æ¨é€çš„äº‹ä»¶é€šçŸ¥ã€‚WeGoåº“æä¾›äº†å®Œæ•´çš„äº‹ä»¶å¤„ç†æœºåˆ¶ï¼Œæ”¯æŒå¤šç§æˆæƒå˜æ›´äº‹ä»¶çš„æ¥æ”¶å’Œå¤„ç†ã€‚

## äº‹ä»¶ç±»å‹

### 1. æˆæƒæˆåŠŸäº‹ä»¶ (authorized)
å½“å…¬ä¼—å·/æœåŠ¡å·/å°ç¨‹åº/å¾®ä¿¡å°åº—/å¸¦è´§åŠ©æ‰‹/è§†é¢‘å·åŠ©æ‰‹å¯¹ç¬¬ä¸‰æ–¹å¹³å°è¿›è¡Œæˆæƒæ—¶è§¦å‘ã€‚<mcreference link="https://developers.weixin.qq.com/doc/oplatform/Third-party_Platforms/2.0/api/Before_Develop/authorize_event.html" index="0">0</mcreference>

### 2. å–æ¶ˆæˆæƒäº‹ä»¶ (unauthorized)  
å½“å…¬ä¼—å·/æœåŠ¡å·/å°ç¨‹åº/å¾®ä¿¡å°åº—/å¸¦è´§åŠ©æ‰‹/è§†é¢‘å·åŠ©æ‰‹å–æ¶ˆå¯¹ç¬¬ä¸‰æ–¹å¹³å°çš„æˆæƒæ—¶è§¦å‘ã€‚<mcreference link="https://developers.weixin.qq.com/doc/oplatform/Third-party_Platforms/2.0/api/Before_Develop/authorize_event.html" index="0">0</mcreference>

### 3. æˆæƒæ›´æ–°äº‹ä»¶ (updateauthorized)
å½“æˆæƒæ–¹æ›´æ–°æˆæƒæ—¶è§¦å‘ã€‚å¦‚æœæ›´æ–°æˆæƒæ—¶ï¼Œæˆæƒçš„æƒé™é›†æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œå°†ä¸ä¼šè§¦å‘æˆæƒæ›´æ–°é€šçŸ¥ã€‚<mcreference link="https://developers.weixin.qq.com/doc/oplatform/Third-party_Platforms/2.0/api/Before_Develop/authorize_event.html" index="0">0</mcreference>

## äº‹ä»¶æ¨é€æ ¼å¼

### XMLæ ¼å¼ç¤ºä¾‹

```xml
<!-- æˆæƒæˆåŠŸäº‹ä»¶ -->
<xml>
  <AppId><![CDATA[ç¬¬ä¸‰æ–¹å¹³å°AppID]]></AppId>
  <CreateTime>1413192760</CreateTime>
  <InfoType><![CDATA[authorized]]></InfoType>
  <AuthorizerAppid><![CDATA[æˆæƒæ–¹AppID]]></AuthorizerAppid>
  <AuthorizationCode><![CDATA[æˆæƒç ]]></AuthorizationCode>
  <AuthorizationCodeExpiredTime>1413196360</AuthorizationCodeExpiredTime>
  <PreAuthCode><![CDATA[é¢„æˆæƒç ]]></PreAuthCode>
</xml>

<!-- å–æ¶ˆæˆæƒäº‹ä»¶ -->
<xml>
  <AppId><![CDATA[ç¬¬ä¸‰æ–¹å¹³å°AppID]]></AppId>
  <CreateTime>1413192760</CreateTime>
  <InfoType><![CDATA[unauthorized]]></InfoType>
  <AuthorizerAppid><![CDATA[æˆæƒæ–¹AppID]]></AuthorizerAppid>
</xml>

<!-- æˆæƒæ›´æ–°äº‹ä»¶ -->
<xml>
  <AppId><![CDATA[ç¬¬ä¸‰æ–¹å¹³å°AppID]]></AppId>
  <CreateTime>1413192760</CreateTime>
  <InfoType><![CDATA[updateauthorized]]></InfoType>
  <AuthorizerAppid><![CDATA[æˆæƒæ–¹AppID]]></AuthorizerAppid>
  <AuthorizationCode><![CDATA[æˆæƒç ]]></AuthorizationCode>
  <AuthorizationCodeExpiredTime>1413196360</AuthorizationCodeExpiredTime>
  <PreAuthCode><![CDATA[é¢„æˆæƒç ]]></PreAuthCode>
</xml>
```

## äº‹ä»¶å¤„ç†å®ç°

### äº‹ä»¶å¤„ç†å™¨æ¥å£

WeGoåº“å®šä¹‰äº†å®Œæ•´çš„äº‹ä»¶å¤„ç†å™¨æ¥å£ï¼Œæ”¯æŒè‡ªå®šä¹‰äº‹ä»¶å¤„ç†é€»è¾‘ï¼š

```go
// EventHandler äº‹ä»¶å¤„ç†å™¨æ¥å£
type EventHandler interface {
    // HandleAuthorized å¤„ç†æˆæƒæˆåŠŸäº‹ä»¶
    HandleAuthorized(ctx context.Context, event *AuthorizedEvent) error

    // HandleUnauthorized å¤„ç†å–æ¶ˆæˆæƒäº‹ä»¶  
    HandleUnauthorized(ctx context.Context, event *UnauthorizedEvent) error

    // HandleUpdateAuthorized å¤„ç†æˆæƒæ›´æ–°äº‹ä»¶
    HandleUpdateAuthorized(ctx context.Context, event *UpdateAuthorizedEvent) error

    // HandleComponentVerifyTicket å¤„ç†éªŒè¯ç¥¨æ®æ¨é€äº‹ä»¶
    // æ ¹æ®å¾®ä¿¡å®˜æ–¹æ–‡æ¡£<mcreference link="https://developers.weixin.qq.com/doc/oplatform/Third-party_Platforms/2.0/api/Before_Develop/component_verify_ticket.html" index="0">0</mcreference>ï¼Œ
    // æ¥æ”¶POSTè¯·æ±‚ååªéœ€ç›´æ¥è¿”å›å­—ç¬¦ä¸²"success"
    HandleComponentVerifyTicket(ctx context.Context, event *ComponentVerifyTicketEvent) error

    // HandleEncodingAESKeyChanged å¤„ç†EncodingAESKeyå˜æ›´äº‹ä»¶
    // å½“ç¬¬ä¸‰æ–¹å¹³å°åœ¨å¾®ä¿¡å¼€æ”¾å¹³å°åå°ä¿®æ”¹EncodingAESKeyæ—¶ï¼Œå¾®ä¿¡æœåŠ¡å™¨ä¼šæ¨é€æ­¤äº‹ä»¶
    // æ ¹æ®å¾®ä¿¡å®˜æ–¹è§„èŒƒ<mcreference link="https://developers.weixin.qq.com/doc/oplatform/Third-party_Platforms/2.0/api/Before_Develop/Message_encryption_and_decryption.html" index="1">1</mcreference>ï¼Œ
    // éœ€è¦ä¿å­˜ä¸Šä¸€æ¬¡çš„EncodingAESKeyä»¥ç¡®ä¿å¹³æ»‘è¿‡æ¸¡
    HandleEncodingAESKeyChanged(ctx context.Context, event *EncodingAESKeyChangedEvent) error
}

// DefaultEventHandler é»˜è®¤äº‹ä»¶å¤„ç†å™¨
type DefaultEventHandler struct{}

func (h *DefaultEventHandler) HandleAuthorized(ctx context.Context, event *AuthorizedEvent) error {
    return nil
}

func (h *DefaultEventHandler) HandleUnauthorized(ctx context.Context, event *UnauthorizedEvent) error {
    return nil
}

func (h *DefaultEventHandler) HandleUpdateAuthorized(ctx context.Context, event *UpdateAuthorizedEvent) error {
    return nil
}

func (h *DefaultEventHandler) HandleComponentVerifyTicket(ctx context.Context, event *ComponentVerifyTicketEvent) error {
    // æ ¹æ®å¾®ä¿¡å®˜æ–¹æ–‡æ¡£<mcreference link="https://developers.weixin.qq.com/doc/oplatform/Third-party_Platforms/2.0/api/Before_Develop/component_verify_ticket.html" index="0">0</mcreference>ï¼Œ
    // æ¥æ”¶POSTè¯·æ±‚ååªéœ€ç›´æ¥è¿”å›å­—ç¬¦ä¸²"success"
    // è¿™é‡Œå¯ä»¥æ·»åŠ ç¥¨æ®å­˜å‚¨é€»è¾‘ï¼Œä½†å³ä½¿å¤„ç†å¤±è´¥ä¹Ÿå¿…é¡»è¿”å›success
    return nil
}

func (h *DefaultEventHandler) HandleEncodingAESKeyChanged(ctx context.Context, event *EncodingAESKeyChangedEvent) error {
    return nil
}
```

### äº‹ä»¶å¤„ç†æµç¨‹

æ ¹æ®å¾®ä¿¡å®˜æ–¹æ–‡æ¡£<mcreference link="https://developers.weixin.qq.com/doc/oplatform/Third-party_Platforms/2.0/api/Before_Develop/authorize_event.html" index="0">0</mcreference>ï¼Œæ¥æ”¶POSTè¯·æ±‚ååªéœ€ç›´æ¥è¿”å›å­—ç¬¦ä¸²"success"ã€‚WeGoåº“æä¾›äº†å®Œæ•´çš„HandleAuthorizationEventæ–¹æ³•ï¼Œæ”¯æŒæ˜æ–‡å’ŒåŠ å¯†ä¸¤ç§æ¶ˆæ¯æ ¼å¼ï¼š

```go
// HandleAuthorizationEvent å¤„ç†å¾®ä¿¡å¼€æ”¾å¹³å°æˆæƒäº‹ä»¶
// æ”¯æŒæ˜æ–‡å’ŒåŠ å¯†ä¸¤ç§æ¶ˆæ¯æ ¼å¼
// æ ¹æ®å¾®ä¿¡å®˜æ–¹æ–‡æ¡£<mcreference link="https://developers.weixin.qq.com/doc/oplatform/Third-party_Platforms/2.0/api/Before_Develop/authorize_event.html" index="0">0</mcreference>ï¼Œ
// æ¥æ”¶POSTè¯·æ±‚ååªéœ€ç›´æ¥è¿”å›å­—ç¬¦ä¸²"success"
func (c *APIClient) HandleAuthorizationEvent(ctx context.Context, msgSignature, timestamp, nonce, encryptType string, body []byte) (string, error) {
    // é¦–å…ˆæ£€æµ‹æ˜¯å¦ä¸ºåŠ å¯†æ¶ˆæ¯
    var encryptedMsg struct {
        XMLName    xml.Name `xml:"xml"`
        AppId      string   `xml:"AppId"`
        Encrypt    string   `xml:"Encrypt"`
        CreateTime int64    `xml:"CreateTime"`
    }

    // åˆ¤æ–­æ¶ˆæ¯ç±»å‹ï¼šæ ¹æ®encrypt_typeå‚æ•°æˆ–XMLå†…å®¹æ£€æµ‹
    isEncrypted := encryptType == "aes" && msgSignature != ""

    // å¦‚æœURLå‚æ•°è¡¨æ˜æ˜¯åŠ å¯†æ¶ˆæ¯ï¼Œæˆ–è€…XMLå†…å®¹åŒ…å«Encryptå­—æ®µï¼Œåˆ™è¿›è¡Œè§£å¯†
    if isEncrypted {
        // å°è¯•è§£æXMLè·å–åŠ å¯†å†…å®¹
        if err := xml.Unmarshal(xmlData, &encryptedMsg); err != nil {
            return "success", nil // å³ä½¿è§£æå¤±è´¥ä¹Ÿè¿”å›success
        }

        if encryptedMsg.Encrypt == "" {
            return "success", nil
        }

        // è§£å¯†æ¶ˆæ¯
        decryptedData, err := c.DecryptMessage(encryptedMsg.Encrypt, msgSignature, timestamp, nonce)
        if err != nil {
            return "success", nil // å³ä½¿è§£å¯†å¤±è´¥ä¹Ÿè¿”å›success
        }

        // ä½¿ç”¨è§£å¯†åçš„æ•°æ®ç»§ç»­å¤„ç†
        xmlData = decryptedData
    }

    // è§£æXMLè·å–åŸºç¡€äº‹ä»¶ä¿¡æ¯
    var baseEvent AuthorizationEvent
    err := xml.Unmarshal(xmlData, &baseEvent)
    if err != nil {
        return "success", nil // å³ä½¿è§£æå¤±è´¥ä¹Ÿè¿”å›success
    }

    // éªŒè¯äº‹ä»¶ç­¾åå’Œæ—¶é—´æˆ³
    if err := c.validateAuthorizationEvent(&baseEvent); err != nil {
        return "success", nil // å³ä½¿éªŒè¯å¤±è´¥ä¹Ÿè¿”å›success
    }

    // æ ¹æ®äº‹ä»¶ç±»å‹è¿›è¡Œå¤„ç†
    switch baseEvent.InfoType {
    case "authorized":
        var event AuthorizedEvent
        err := xml.Unmarshal(xmlData, &event)
        if err != nil {
            break
        }

        if err := c.GetEventHandler().HandleAuthorized(ctx, &event); err != nil {
            // è®°å½•é”™è¯¯æ—¥å¿—ï¼Œä½†ä¾ç„¶è¿”å›success
        }

    case "unauthorized":
        var event UnauthorizedEvent
        err := xml.Unmarshal(xmlData, &event)
        if err != nil {
            break
        }

        if err := c.GetEventHandler().HandleUnauthorized(ctx, &event); err != nil {
            // è®°å½•é”™è¯¯æ—¥å¿—ï¼Œä½†ä¾ç„¶è¿”å›success
        }

    case "updateauthorized":
        var event UpdateAuthorizedEvent
        err := xml.Unmarshal(xmlData, &event)
        if err != nil {
            break
        }

        if err := c.GetEventHandler().HandleUpdateAuthorized(ctx, &event); err != nil {
            // è®°å½•é”™è¯¯æ—¥å¿—ï¼Œä½†ä¾ç„¶è¿”å›success
        }

    case "component_verify_ticket":
        var event ComponentVerifyTicketEvent
        err := xml.Unmarshal(xmlData, &event)
        if err != nil {
            break
        }

        // å­˜å‚¨éªŒè¯ç¥¨æ®
        if err := c.storage.SaveVerifyTicket(ctx, event.ComponentVerifyTicket); err != nil {
            // è®°å½•é”™è¯¯æ—¥å¿—ï¼Œä½†ä¾ç„¶è¿”å›success
        }

        if err := c.GetEventHandler().HandleComponentVerifyTicket(ctx, &event); err != nil {
            // è®°å½•é”™è¯¯æ—¥å¿—ï¼Œä½†ä¾ç„¶è¿”å›success
        }

    case "encoding_aes_key_changed":
        var event EncodingAESKeyChangedEvent
        err := xml.Unmarshal(xmlData, &event)
        if err != nil {
            break
        }

        // ä¿å­˜ä¸Šä¸€æ¬¡çš„EncodingAESKey
        if c.crypt != nil {
            c.crypt.SetPrevEncodingAESKey(c.config.EncodingAESKey)
        }

        // æ›´æ–°é…ç½®ä¸­çš„EncodingAESKey
        c.config.EncodingAESKey = event.NewEncodingAESKey

        if err := c.GetEventHandler().HandleEncodingAESKeyChanged(ctx, &event); err != nil {
            // è®°å½•é”™è¯¯æ—¥å¿—ï¼Œä½†ä¾ç„¶è¿”å›success
        }

    default:
        // è®°å½•æœªçŸ¥äº‹ä»¶ç±»å‹æ—¥å¿—
    }

    // æ ¹æ®å¾®ä¿¡å®˜æ–¹æ–‡æ¡£è¦æ±‚ï¼Œå¿…é¡»è¿”å›"success"å­—ç¬¦ä¸²
    return "success", nil
}
```

## å®Œæ•´ç¤ºä¾‹

### 1. è‡ªå®šä¹‰äº‹ä»¶å¤„ç†å™¨

```go
package main

import (
    "context"
    "database/sql"
    "fmt"
    "io"
    "net/http"
    "github.com/jcbowen/wego"
)

// è‡ªå®šä¹‰äº‹ä»¶å¤„ç†å™¨
type MyEventHandler struct {
    client *wego.OpenPlatformClient
    db     *sql.DB // å‡è®¾æœ‰æ•°æ®åº“è¿æ¥
}

func (h *MyEventHandler) HandleAuthorized(ctx context.Context, event *wego.AuthorizedEvent) error {
    fmt.Printf("ğŸ‰ æ–°çš„æˆæƒæˆåŠŸ: %s\n", event.AuthorizerAppid)
    
    // 1. ä½¿ç”¨æˆæƒç è·å–æˆæƒä¿¡æ¯
    authInfo, err := h.client.QueryAuth(ctx, event.AuthorizationCode)
    if err != nil {
        return fmt.Errorf("è·å–æˆæƒä¿¡æ¯å¤±è´¥: %v", err)
    }
    
    // 2. è·å–æˆæƒæ–¹è¯¦ç»†ä¿¡æ¯
    authorizerInfo, err := h.client.GetAuthorizerInfo(ctx, event.AuthorizerAppid)
    if err != nil {
        return fmt.Errorf("è·å–æˆæƒæ–¹ä¿¡æ¯å¤±è´¥: %v", err)
    }
    
    // 3. å­˜å‚¨åˆ°æ•°æ®åº“
    err = h.saveAuthorization(authInfo, authorizerInfo)
    if err != nil {
        return fmt.Errorf("å­˜å‚¨æˆæƒä¿¡æ¯å¤±è´¥: %v", err)
    }
    
    fmt.Printf("âœ… æˆæƒæ–¹ %s ä¿¡æ¯å·²ä¿å­˜\n", authorizerInfo.NickName)
    return nil
}

func (h *MyEventHandler) HandleUnauthorized(ctx context.Context, event *wego.UnauthorizedEvent) error {
    fmt.Printf("âš ï¸ å–æ¶ˆæˆæƒ: %s\n", event.AuthorizerAppid)
    
    // æ¸…ç†ç›¸å…³æ•°æ®
    err := h.cleanupAuthorization(event.AuthorizerAppid)
    if err != nil {
        return fmt.Errorf("æ¸…ç†æˆæƒæ•°æ®å¤±è´¥: %v", err)
    }
    
    fmt.Printf("âœ… æˆæƒæ–¹ %s æ•°æ®å·²æ¸…ç†\n", event.AuthorizerAppid)
    return nil
}

func (h *MyEventHandler) HandleUpdateAuthorized(ctx context.Context, event *wego.UpdateAuthorizedEvent) error {
    fmt.Printf("ğŸ”„ æˆæƒæ›´æ–°: %s\n", event.AuthorizerAppid)
    
    // é‡æ–°è·å–æˆæƒä¿¡æ¯
    authInfo, err := h.client.QueryAuth(ctx, event.AuthorizationCode)
    if err != nil {
        return fmt.Errorf("è·å–æ›´æ–°æˆæƒä¿¡æ¯å¤±è´¥: %v", err)
    }
    
    // æ›´æ–°æ•°æ®åº“ä¸­çš„æˆæƒä¿¡æ¯
    err = h.updateAuthorization(authInfo)
    if err != nil {
        return fmt.Errorf("æ›´æ–°æˆæƒä¿¡æ¯å¤±è´¥: %v", err)
    }
    
    fmt.Printf("âœ… æˆæƒæ–¹ %s ä¿¡æ¯å·²æ›´æ–°\n", event.AuthorizerAppid)
    return nil
}

// æ•°æ®åº“æ“ä½œæ–¹æ³•ï¼ˆç¤ºä¾‹ï¼‰
func (h *MyEventHandler) saveAuthorization(authInfo *wego.AuthorizationInfo, authorizerInfo *wego.AuthorizerInfo) error {
    // å®ç°æ•°æ®åº“å­˜å‚¨é€»è¾‘
    return nil
}

func (h *MyEventHandler) cleanupAuthorization(appID string) error {
    // å®ç°æ•°æ®æ¸…ç†é€»è¾‘
    return nil
}

func (h *MyEventHandler) updateAuthorization(authInfo *wego.AuthorizationInfo) error {
    // å®ç°æ•°æ®æ›´æ–°é€»è¾‘
    return nil
}
```

### 2. é›†æˆåˆ°HTTPæœåŠ¡å™¨

```go
func main() {
    config := &wego.OpenPlatformConfig{
        ComponentAppID:     "your_component_appid",
        ComponentAppSecret: "your_component_appsecret",
        ComponentToken:     "your_component_token",
        EncodingAESKey:     "your_encoding_aes_key",
    }
    
    client := wego.NewOpenPlatformClient(config)
    
    // è®¾ç½®è‡ªå®šä¹‰äº‹ä»¶å¤„ç†å™¨
    eventHandler := &MyEventHandler{client: client, db: yourDB}
    client.SetEventHandler(eventHandler)
    
    // HTTPæ¶ˆæ¯å¤„ç†
    http.HandleFunc("/wego/callback", func(w http.ResponseWriter, r *http.Request) {
        // è·å–URLå‚æ•°
        signature := r.URL.Query().Get("msg_signature")
        timestamp := r.URL.Query().Get("timestamp")
        nonce := r.URL.Query().Get("nonce")
        encryptType := r.URL.Query().Get("encrypt_type")
        
        // è¯»å–è¯·æ±‚ä½“
        body, err := io.ReadAll(r.Body)
        if err != nil {
            http.Error(w, "è¯»å–è¯·æ±‚ä½“å¤±è´¥", http.StatusBadRequest)
            return
        }
        
        // ä½¿ç”¨HandleAuthorizationEventæ–¹æ³•å¤„ç†æˆæƒäº‹ä»¶
        response, err := client.HandleAuthorizationEvent(r.Context(), body, signature, timestamp, nonce, encryptType)
        if err != nil {
            http.Error(w, err.Error(), http.StatusInternalServerError)
            return
        }
        
        // è¿”å›å“åº”
        w.Header().Set("Content-Type", "text/plain")
        w.Write([]byte(response))
    })
    
    http.ListenAndServe(":8080", nil)
}
```

## äº‹ä»¶å¤„ç†æœ€ä½³å®è·µ

### 1. å¹‚ç­‰æ€§å¤„ç†
ç¡®ä¿äº‹ä»¶å¤„ç†æ˜¯å¹‚ç­‰çš„ï¼Œé¿å…é‡å¤å¤„ç†å¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚

### 2. å¼‚æ­¥å¤„ç†
å¯¹äºè€—æ—¶çš„æ“ä½œï¼ˆå¦‚æ•°æ®åº“æ“ä½œã€APIè°ƒç”¨ï¼‰ï¼Œå»ºè®®ä½¿ç”¨å¼‚æ­¥å¤„ç†ã€‚

### 3. é”™è¯¯å¤„ç†
å®ç°å®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶ï¼Œè®°å½•é”™è¯¯æ—¥å¿—ï¼Œç¡®ä¿æœåŠ¡ç¨³å®šæ€§ã€‚

### 4. ç›‘æ§å‘Šè­¦
è®¾ç½®ç›‘æ§å‘Šè­¦ï¼ŒåŠæ—¶å‘ç°å’Œå¤„ç†äº‹ä»¶å¤„ç†å¼‚å¸¸ã€‚

## æ³¨æ„äº‹é¡¹

### 1. æ¶ˆæ¯éªŒè¯
- å§‹ç»ˆéªŒè¯æ¶ˆæ¯ç­¾å
- æ£€æŸ¥æ—¶é—´æˆ³é˜²æ­¢é‡æ”¾æ”»å‡»
- éªŒè¯AppIDåŒ¹é…

### 2. å“åº”è¦æ±‚
- å¿…é¡»åœ¨5ç§’å†…è¿”å›å“åº”
- å“åº”æ ¼å¼å¿…é¡»æ­£ç¡®
- é”™è¯¯æ—¶è¿”å›é€‚å½“çš„é”™è¯¯ç 

### 3. æ•°æ®ä¸€è‡´æ€§
- ç¡®ä¿äº‹ä»¶å¤„ç†çš„æ•°æ®ä¸€è‡´æ€§
- å®ç°äº‹åŠ¡å¤„ç†æœºåˆ¶
- å¤„ç†å¹¶å‘äº‹ä»¶

## å¸¸è§é—®é¢˜

### Q: æ”¶ä¸åˆ°æˆæƒå˜æ›´äº‹ä»¶
A: æ£€æŸ¥æœåŠ¡å™¨é…ç½®ã€ç½‘ç»œè¿æ¥ã€æ¶ˆæ¯ç­¾åéªŒè¯

### Q: äº‹ä»¶å¤„ç†è¶…æ—¶
A: ä¼˜åŒ–å¤„ç†é€»è¾‘ï¼Œå®ç°å¼‚æ­¥å¤„ç†ï¼Œç¡®ä¿5ç§’å†…å“åº”

### Q: é‡å¤äº‹ä»¶å¤„ç†
A: å®ç°å¹‚ç­‰æ€§å¤„ç†ï¼Œæ£€æŸ¥äº‹ä»¶IDæˆ–æ—¶é—´æˆ³

## ç›¸å…³API

- `HandleAuthorizationEvent(ctx context.Context, msgSignature, timestamp, nonce, encryptType string, body []byte) (string, error)` - å¤„ç†æˆæƒå˜æ›´äº‹ä»¶ï¼Œæ”¯æŒæ˜æ–‡å’ŒåŠ å¯†æ¶ˆæ¯æ ¼å¼
- `SetEventHandler(handler EventHandler)` - è®¾ç½®è‡ªå®šä¹‰äº‹ä»¶å¤„ç†å™¨
- `QueryAuth(ctx context.Context, authorizationCode string) (*AuthorizationInfo, error)` - ä½¿ç”¨æˆæƒç è·å–æˆæƒä¿¡æ¯
- `GetAuthorizerInfo(ctx context.Context, authorizerAppID string) (*AuthorizerInfo, error)` - è·å–æˆæƒæ–¹è¯¦ç»†ä¿¡æ¯
- `DecryptMessage(encryptedMsg, msgSignature, timestamp, nonce string) ([]byte, error)` - è§£å¯†åŠ å¯†æ¶ˆæ¯
- `GetEventHandler() EventHandler` - è·å–å½“å‰äº‹ä»¶å¤„ç†å™¨

é€šè¿‡wxopenç»„ä»¶ï¼Œæ‚¨å¯ä»¥è½»æ¾å¤„ç†å„ç§æˆæƒå˜æ›´äº‹ä»¶ï¼Œç¡®ä¿ç¬¬ä¸‰æ–¹å¹³å°æœåŠ¡çš„ç¨³å®šè¿è¡Œã€‚